!function($){"use strict";var vstr_infos,vstr_panel,vstr_frame,vstr_cursor,vstr_step=0,vstr_timer=!1;function initListeners(){$("body").on("vstr_initFrame",vstr_initFrame),$("#vstr_form_settings").on("submit",function(){jQuery("#vstr_response").hide();var data={action:"vstr_settings_save"};return jQuery("#vstr_form_settings input, #vstr_form_settings select, #vstr_form_settings textarea").each(function(){jQuery(this).attr("name")&&eval("data."+jQuery(this).attr("name")+" = jQuery(this).val();")}),jQuery.post(ajaxurl,data,function(t){jQuery("#vstr_response").html('<div id="message" class="updated"><p><strong>'+vstr_settings.txt_settingsSaved+"</strong>.</p></div>"),setTimeout(function(){document.location.href="admin.php?page=vstr-settings"},250)}),!1})}function vstr_viewVisit(){vstr_infos=jQuery('<div id="vstr_infos"></div>'),"left"==vstr_settings[0].panelPosition&&vstr_infos.css({right:"auto",left:20}),vstr_panel=jQuery('<div id="vstr_panel"></div>');var t=jQuery('<iframe id="vstr_frame"></iframe>');"https://"==vstr_visitDatas.steps[0].page.substr(0,8)&&"http://"==document.location.href.substr(0,7)?vstr_visitDatas.steps[0].page="http://"+vstr_visitDatas.steps[0].page.substr(8,vstr_visitDatas.steps[0].page.length):"http://"==vstr_visitDatas.steps[0].page.substr(0,7)&&"https://"==document.location.href.substr(0,8)&&(vstr_visitDatas.steps[0].page="https://"+vstr_visitDatas.steps[0].page.substr(7,vstr_visitDatas.steps[0].page.length)),t.prop("src",vstr_visitDatas.steps[0].page),parseInt(vstr_visitDatas.screenWidth)>jQuery(window).width()&&(vstr_visitDatas.screenWidth=jQuery(window).width()),parseInt(vstr_visitDatas.screenHeight)+32>jQuery(window).height()?vstr_visitDatas.screenHeight=jQuery(window).height()-32:t.css({marginTop:jQuery(window).height()/2-parseInt(vstr_visitDatas.screenHeight/2)+32}),t.css({width:vstr_visitDatas.screenWidth,height:vstr_visitDatas.screenHeight}),vstr_panel.append(t),vstr_cursor=jQuery('<div id="vstr_cursor"></div>'),jQuery("body").append(vstr_panel),jQuery("body").append(vstr_infos),vstr_panel.fadeIn(250),sessionStorage.vstrAdminStep?vstr_step=parseInt(sessionStorage.vstrAdminStep):sessionStorage.vstrAdminStep=vstr_step}function vstr_initFrame(){vstr_panel.children("iframe").contents().find("html,body").css("overflow-y","auto !important"),vstr_panel.children("iframe").contents().find("body").append(vstr_cursor),vstr_panel.children("iframe").contents().find("*").on("click",function(t){t.preventDefault()}),vstr_cursor.delay(500).fadeIn(250),vstr_startStep(),vstr_displayInfosPage()}function vstr_getDelay(t,s){var e=t.date.split(" "),r=e[0].split("-"),n=e[1].split(":"),t=new Date(r[0],r[1]-1,r[2],n[0],n[1],n[2]),r=(e=s.date.split(" "))[0].split("-"),n=e[1].split(":"),n=new Date(r[0],r[1]-1,r[2],n[0],n[1],n[2]);return Math.round(n-t)}function vstr_displayInfosPage(){vstr_infos.html(""),0==vstr_visitDatas.userID?vstr_infos.append("<p><span>User : </span><strong>"+vstr_visitDatas.user+"</strong></p>"):vstr_infos.append('<p><span>User : </span><a href="user-edit.php?user_id='+vstr_visitDatas.userID+'"><strong>'+vstr_visitDatas.user+"</strong></a></p>");var t=60<(t=vstr_visitDatas.timePast)?(s=Math.floor(t/3600),e=Math.floor(t/60),i=Math.floor(t-60*e),s<10&&(s="0"+s),e<10&&(e="0"+e),i<10&&(i="0"+(i=Math.floor(i))),s+":"+e+":"+i):(t<10&&(t="0"+Math.floor(t)),"00:00:"+Math.floor(t));vstr_infos.append("<p><span>Visit total duration : </span><strong>"+t+"</strong></p>"),0<vstr_panel.children("iframe").contents().find("title").length&&vstr_infos.append("<p><span>Current page : </span><strong>"+vstr_panel.children("iframe").contents().find("title").html()+"</strong></p>"),vstr_infos.append("<p><span>Current url : </span><strong>"+vstr_panel.children("iframe").prop("src")+"</strong></p>");var s,e,r=!1,n=0;jQuery.each(vstr_visitDatas.steps,function(t,s){!r&&vstr_step<t&&s.timePast&&0<s.timePast&&(n+=parseInt(s.timePast)),!r&&vstr_step<t&&""!=s.page&&s.page!=vstr_panel.children("iframe").prop("src")&&(r=s)}),r&&(s=Math.floor(n/3600),e=Math.floor(n/60),i=Math.floor(n-60*e),s<10&&(s="0"+s),e<10&&(e="0"+e),i<10&&(i="0"+(i=Math.floor(i))),n=s+":"+e+":"+i,vstr_infos.append("<p><span>Time past on this page : </span><strong>"+n+"</strong></p>"));var i=jQuery('<div id="vstr_arrows"></div>');i.append('<a href="javascript:" class="vstr_btn_prev"></a>'),i.append('<a href="javascript:" class="vstr_btn_pause"></a>'),i.append('<a href="javascript:" class="vstr_btn_next"></a>'),i.find(".vstr_btn_prev").on("click",vstr_prev),i.find(".vstr_btn_pause").on("click",vstr_pause),i.find(".vstr_btn_next").on("click",vstr_next),vstr_infos.append(i);i=jQuery('<a id="vstr_close" href="javascript:"></a>');i.on("click",vstr_endVisit),vstr_infos.prepend(i)}function vstr_Timer(t,s){var e,r,n=s;this.pause=function(){window.clearTimeout(e),n-=new Date-r},this.resume=function(){r=new Date,e=window.setTimeout(t,n)},this.resume()}function vstr_pause(){jQuery(".vstr_btn_pause").is(".play")?(jQuery(".vstr_btn_pause").removeClass("play"),vstr_timer.resume()):(jQuery(".vstr_btn_pause").addClass("play"),vstr_timer.pause())}function vstr_hasPrev(){var e=!1;return jQuery.each(vstr_visitDatas.steps,function(t,s){t<vstr_step&&""!=s.page&&s.page!=vstr_panel.children("iframe").prop("src")&&(e=!0)}),e}function vstr_prev(){var e=-1;jQuery.each(vstr_visitDatas.steps,function(t,s){e<0&&t<vstr_step&&""!=s.page&&s.page!=vstr_panel.children("iframe").prop("src")&&(e=t)}),-1<e&&(vstr_step=e,vstr_startStep())}function vstr_next(){var e=!1;jQuery.each(vstr_visitDatas.steps,function(t,s){!e&&vstr_step<t&&""!=s.page&&s.page!=vstr_panel.children("iframe").prop("src")&&(e=t)}),e?(vstr_step=e,vstr_startStep()):vstr_endVisit()}function vstr_clickFx(){var t=jQuery('<div class="vstr_fx"></div>');t.css({left:vstr_cursor.offset().left+vstr_cursor.outerWidth()/2-15,top:vstr_cursor.offset().top+vstr_cursor.outerHeight()/2-20}),vstr_panel.children("iframe").contents().find("body").append(t),t.fadeIn(100),setTimeout(function(){t.remove()},600)}function vstr_isAnyParentFixed(t,s){s=s||!1;try{0<t.parent().length&&"fixed"==t.parent().css("position")&&(s=!0)}catch(t){}return!s&&0<t.parent().length&&(s=vstr_isAnyParentFixed(t.parent(),s)),s}function vstr_fakeClick(t){var s;t.click?t.trigger("click"):document.createEvent&&((s=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(s))}function vstr_startStep(){sessionStorage.vstrAdminStep=vstr_step;var t=vstr_visitDatas.steps[vstr_step];t.page&&("https://"==t.page.substr(0,8)&&"http://"==document.location.href.substr(0,7)?t.page="http://"+t.page.substr(8,t.page.length):"http://"==t.page.substr(0,7)&&"https://"==document.location.href.substr(0,8)&&(t.page="https://"+t.page.substr(7,t.page.length))),vstr_hasPrev()?jQuery(".vstr_btn_prev").show():jQuery(".vstr_btn_prev").hide(),t.page&&t.page!=vstr_panel.children("iframe").prop("src")?(vstr_clickFx(),setTimeout(function(){vstr_panel.children("iframe").prop("src",t.page),vstr_displayInfosPage()},1e3)):(vstr_panel.children("iframe").contents().find("#wpadminbar").remove(),""!=t.domElement||"scroll"==t.type?(0<vstr_panel.children("iframe").contents().find(t.domElement).length?(vstr_cursor.animate({left:vstr_panel.children("iframe").contents().find(t.domElement).offset().left+vstr_panel.children("iframe").contents().find(t.domElement).outerWidth()/2,top:vstr_panel.children("iframe").contents().find(t.domElement).offset().top+vstr_panel.children("iframe").contents().find(t.domElement).outerHeight()/2},400),vstr_isAnyParentFixed(vstr_panel.children("iframe").contents().find(t.domElement))||vstr_panel.children("iframe").contents().find("html,body").animate({scrollTop:vstr_panel.children("iframe").contents().find(t.domElement).position().top-200,scrollLeft:vstr_panel.children("iframe").contents().find(t.domElement).position().left-100},500,"easeInOutCubic"),"click"==t.type&&setTimeout(function(){vstr_clickFx(),-1==t.domElement.indexOf("submit")&&0<vstr_panel.children("iframe").contents().find(t.domElement).length&&!vstr_panel.children("iframe").contents().find(t.domElement).is('[type="submit"]')&&setTimeout(function(){vstr_panel.children("iframe").contents().find(t.domElement).get(0).trigger("click")},500)},400),"hover"==t.type&&setTimeout(function(){vstr_panel.children("iframe").contents().find(t.domElement).addClass("hover")},600),"click"==t.type||"hover"==t.type?vstr_cursor.addClass("pointer"):vstr_cursor.removeClass("pointer")):"scroll"==t.type&&setTimeout(function(){vstr_panel.children("iframe").contents().find("html,body").animate({scrollTop:parseInt(t.value)},1e3)},600),vstr_timer=vstr_visitDatas.steps[vstr_step+1]?(vstr_step++,new vstr_Timer(vstr_startStep,vstr_getDelay(t,vstr_visitDatas.steps[vstr_step])+300)):new vstr_Timer(vstr_endVisit,3e3)):vstr_visitDatas.steps[vstr_step+1]?(vstr_step++,vstr_startStep()):vstr_endVisit())}function vstr_endVisit(){sessionStorage.vstrAdminStep=0,vstr_infos.fadeOut(500),vstr_panel.fadeOut(500),setTimeout(function(){vstr_panel.remove(),vstr_infos.remove()},800)}jQuery(document).ready(function(){vstr_step=0,"0"!=vstr_visitDatas&&vstr_visitDatas.steps&&vstr_viewVisit(),initListeners(),jQuery(document).tooltip({items:".infoUrls",content:function(){return jQuery(this).attr("data-urls")},open:function(t,s){s.tooltip.css("max-width","980px")}})})}(jQuery);